
<app-header></app-header>
<div>
	<ngx-datatable
		style="width: 90%"
		class="material"
		[groupRowsBy]="'organizacion'"
		[rows]="agrupaciones"
		[columnMode]="'force'"
		[headerHeight]="40"
		[footerHeight]="10"
		[rowHeight]="'100%'"
		[loadingIndicator]="loadingIndicator"
		[groupExpansionDefault]="true"
		>
	  <ngx-datatable-group-header [rowHeight]="50" #myGroupHeader >
          <ng-template let-group="group" let-expanded="expanded" ngx-datatable-group-header-template>
            <div style="padding-left:5px;">
              
                <b> Fundación: {{group.value[0].organizacion}}</b>
                                   
            </div>
          </ng-template>
        </ngx-datatable-group-header>
	  <ngx-datatable-column name="Barrio"></ngx-datatable-column>
	  <ngx-datatable-column name="Hombres"></ngx-datatable-column>
	  <ngx-datatable-column name="Mujeres"></ngx-datatable-column>
	  <ngx-datatable-column name="Total"></ngx-datatable-column>
	  <ngx-datatable-column>
		<ng-template ngx-datatable-cell-template let-row="row">
		  
		  <button #btnElement class="btn-warning btn" (click)="gestiona(gestionaModal, row.id)"><i class="fa fa-pencil-square-o"></i></button>&nbsp;
		  <button #btnElement class="btn-danger btn"  (click)="borrar(row.id, row.barrio, 'barrio',eliminaModal)"><i class="fa fa-trash"></i></button>
		</ng-template>
		
		<ngx-datatable-footer>
          <ng-template 
            ngx-datatable-footer-template 
            let-rowCount="rowCount"
            let-pageSize="pageSize"
            let-selectedCount="selectedCount"
            let-curPage="curPage"
            let-offset="offset">
            <div style="padding: 5px 10px">
              
            </div>
          </ng-template>
        </ngx-datatable-footer>
	  </ngx-datatable-column>
	</ngx-datatable>
</div>

<ng-template #gestionaModal let-c="close" let-d="dismiss">
      <div class="modal-header">
        <h2 class="modal-title">Gestion Barrio </h2>
        <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
            <span aria-hidden="true">&times;</span>
          </button>
      </div>
        <div class="modal-body">
            <div>
				<ngx-datatable
					style="width: 90%"
					class="material"
					[rows]="usuarios"
					[columnMode]="'force'"
					[headerHeight]="40"
					[footerHeight]="50"
					[rowHeight]="'100%'"
					[loadingIndicator]="loadingIndicator"
					[limit]="6"
					>
				  <ngx-datatable-column name="Organizacion"></ngx-datatable-column>
				  <ngx-datatable-column name="Barrio"></ngx-datatable-column>
				  <ngx-datatable-column name="Genero"></ngx-datatable-column>
				  <ngx-datatable-column name="Usuario"></ngx-datatable-column>
				  <ngx-datatable-column name="Telefono"></ngx-datatable-column>
				  <ngx-datatable-column>
            <ng-template ngx-datatable-cell-template let-row="row">
              <button #btnElement class="btn-warning btn" (click)="accion(ingresoModal,row)"><i class="fa fa-pencil-square-o"></i></button>
              <button #btnElement class="btn-danger btn" (click)="borrar(row.id, row.nombre, 'cliente',eliminaModal)"><i class="fa fa-trash"></i></button>
            </ng-template>
				  </ngx-datatable-column>
				</ngx-datatable>
			</div>
			<button type="button" class="btn btn-warning" (click)="accion(ingresoModal)">Agregar nuevo Usuario</button>
        </div> <!-- close modal body -->  
        <div class="modal-footer">
            <button type="button" class="btn btn-light" (click)="c('Close click')">Cerrar</button>
        </div> <!-- close modal footer -->
</ng-template>
  
<ng-template #ingresoModal let-c="close" let-d="dismiss">
    <div class="modal-header">
      <h4 class="modal-title">{{modifica?'Modifica':'Ingresa'}} Usuario</h4>
      <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
        <div class="row">
            <div class="col-sm-4">
                  <label for="nombre">Nombre</label>
                  <input type="string" required class="form-control" id="nombre" [(ngModel)]="newUser.nombre" placeholder="Ingrese nombre"/>
                  <!-- <div class="alert alert-danger" [hidden]="nombre">Valor Requerido</div> -->
            </div>
            <div class="col-sm-4">
                  <label for="apellidoP">Apellido Paterno</label>
                  <input  type="string" required class="form-control" id="apellidoP" [(ngModel)]="newUser.apellidoP" placeholder="Ingrese Apellido Paterno"/> 
            </div>
            <div class="col-sm-4">
                  <label for="apellidoM">Apellido Materno</label>
                  <input  type="string" required class="form-control" id="apellidoM" [(ngModel)]="newUser.apellidoM" placeholder="Ingrese Apellido Materno"/> 
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
                  <label for="genero">Genero:</label>
                  <ng-select [searchable]="false" 
                    [items]="generos" required
                    [multiple]="false"
                    [(ngModel)]="newUser.genero"
                    id="genero"
                    placeholder="Seleccione genero" >
                  </ng-select>
              </div>
            <div class="col-sm-4">
                  <label for="fecha_nacimiento">Fecha de nacimiento:</label>
                  <input  type="date" required class="form-control" [(ngModel)]="newUser.fechaNacimiento"/> 
            </div>
            <div class="col-sm-4">
                  <label for="mail">Mail:</label>
                  <input  type="mail" required class="form-control"[(ngModel)]="newUser.email" placeholder="Ingrese Mail"/> 
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
                  <label for="telefono">Teléfono:</label>
                  <input type="number" required class="form-control"[(ngModel)]="newUser.telefono" placeholder="Ingrese Telefono" minlength="9" maxlength="9"/>
            </div>
            <div class="col-sm-4">
                  <label for="organizacion">Seleccione Organizacion:</label>
                  <ng-select [searchable]="true" 
                      [items]="organizaciones" required
                      bindLabel="nombre"
                      bindValue="id"
                      id="organizacion"
                      [multiple]="false"
                      placeholder="Seleccione organizacion"
                      [(ngModel)]="organizacion"  
                      (ngModelChange)="buscaBarrio($event)" >
                  </ng-select>
            </div>
            <div class="col-sm-4">
                  <label for="barrio">Seleccione Barrio:</label>
                  <ng-select [searchable]="true" 
                      [items]="barrios" required
                      bindLabel="nombre"
                      bindValue="id"
                      id="barrio"
                      [multiple]="false"
                      placeholder="Seleccione barrio"
                      [(ngModel)]="newUser.id_barrio" >
                    </ng-select>
            </div>
          </div>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-success" (click)="ingresaUsuario()"  >Guardar</button>      
      <button type="button" class="btn btn-light" (click)="c('Close click')">Cancelar</button>
    </div>
  </ng-template>

<ng-template #eliminaModal let-c="close" let-d="dismiss">
    <div class="modal-header">
      <h4 class="modal-title">Confirmación</h4>
      <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
        <div class="row">
          <h5>Seguro desea eliminar al {{victima?.tipo}} {{victima?.quien}}</h5>
        </div>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-success" (click)="elimina()"  >Eliminar</button>      
      <button type="button" class="btn btn-light" (click)="cancela()">Cancelar</button>
    </div>
  </ng-template>